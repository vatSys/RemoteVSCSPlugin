<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>VSCS | vatSys</title>
  <meta name="description" content="A simple HTML5 Template for new projects.">
  <meta name="author" content="SitePoint">

  <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
  <link rel="mask-icon" href="favicons/safari-pinned-tab.svg" color="#5bbad5">

  <link rel="stylesheet" href="css/style2.css">

</head>

<body>
  <div class="box">
    <table>
      <tr>
        <td>
          <div id="freqs"></div>
        </td>
        <td>

          <button class="vscs-btn">
            <p>Setup</p>
          </button>

          <br />

          <button class="vscs-btn">
            <p>Coord</p>
          </button>

          <br />

          <button class="vscs-btn">
            <p>Text</p>
          </button>

          <br />

          <button id="group_button" class="vscs-btn">
            <p>Group</p>
          </button>

        </td>
        <td>



        </td>
      </tr>
    </table>

    <span class="status">
      <div id="state">Disconnected</div>
      <div id="msg"></div>
    </span>

  </div>

  <script src="js/jquery-3.6.0.min.js"></script>

  <script type = "text/javascript">
    function Listen() {
       
      if ("WebSocket" in window) {
          // Let us open a web socket
      var url = "ws://" + location.hostname + ":7674/vatsys/vscs";
        var ws = new WebSocket(url);
  
        ws.onopen = function() {
          // Web Socket is connected, send data using send()
          document.getElementById("state").innerHTML = "Connected";
        };
  
        ws.onmessage = function (evt) { 
          
            var vatSysData = JSON.parse(evt.data);
            //document.getElementById("msg").innerHTML = vatSysData;


            // Empty the current freqs.
            document.getElementById("freqs").innerHTML = "";  

            if (vatSysData.Frequencies.length === 0){
                // Do Nothing
            } else {
  
                vatSysData.Frequencies.forEach(item => {

                    var msg = item.FriendlyName.substr(0, 8) + "*";;

                    if(item.Receiving == true) {
                        var styleClass = 'vscs-btn freq-receiving'
                    }
                    else if(item.Primary || item.Transmit) {
                        var styleClass = 'vscs-btn freq-primary-transmit'
                        if(vatSysData.Transmitting){
                        var msg = '++PTT++  '
                        }
                    }
                    else if(item.Receive == true) {
                        var styleClass = 'vscs-btn freq-receive'
                    }
                    else {
                        var styleClass = 'vscs-btn'
                    }

                    var html = '<button class="' + styleClass + '"><p>' + item.Hertz / 1000000 + '</p><p>' + msg + '</p></button>'
                    document.getElementById("freqs").innerHTML += html;

                });
            }

            if(vatSysData.Group == true) {
                var styleClass = 'vscs-btn solid-active'
                document.getElementById("group_button").className = styleClass;
            } else {
                var styleClass = 'vscs-btn'
                document.getElementById("group_button").className = styleClass;
            }

        };
  
        ws.onclose = function() { 
            // websocket is closed.
            document.getElementById("state").innerHTML = "Disconnected";
        };
      } else {
        
        // The browser doesn't support WebSocket
        alert("WebSockets NOT supported by your Browser!");
      }
    }

    $( document ).ready(function() {
      Listen();
    });
 </script>
</body>
</html>